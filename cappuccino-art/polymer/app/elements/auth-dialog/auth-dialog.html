<dom-module id="auth-dialog">
    <style>
    paper-dialog {
        min-width: 300px;
    }
    
    .warning {
        color: red;
    }
    </style>
    <template>
        <paper-dialog id="dialog" modal>
            <h2>Authenticate</h2>
            <div class="warning">{{error}}</div>
            <form id="form" is="iron-form">
                <paper-input label="username" name="username" error-message="Username required!"required validtor autofocus></paper-input>
                <paper-input type="password" label="password" name="password" error-message="Password required!" required validator>
                </paper-input>
            </form>
            <div class="buttons">
                <paper-button on-click='login'>next</paper-button>
            </div>
        </paper-dialog>
        <iron-ajax id="ajax" url="/auth/login" content-type="application/json" method="POST"></iron-ajax>
    </template>
    <script>
    (function() {
        Polymer({
            is: 'auth-dialog',
            listeners: {
                'ajax.error': 'ajaxError',
                'ajax.response': 'ajaxResponse',
            },
            open: function() {
                this.$.dialog.open();
            },
            login: function() {
                console.log(this.$.form.validate());
                if (this.$.form.validate()) {
                    this.$.ajax.body = this.$.form.serialize();
                    this.$.ajax.generateRequest();
                }
            },
            ajaxError: function(e, x) {
                this.error = "Username or password incorrect";
            },
            ajaxResponse: function(e){
                this.$.dialog.close()
            }
        });
    })();
    </script>
</dom-module>
